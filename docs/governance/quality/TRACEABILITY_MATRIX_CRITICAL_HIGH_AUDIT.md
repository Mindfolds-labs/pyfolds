# Matriz de Rastreabilidade — Itens Críticos/Altos da Auditoria

## Consolidação (referências obrigatórias)
- **Issue de consolidação:** [`ISSUE-011-ESPECIAL-consolidacao-fluxo`](../../development/legado/issues/ISSUE-011-ESPECIAL-consolidacao-fluxo.md)
- **ADR de consolidação:** [`ADR-040-governanca-fluxo-issues-no-hub-e-planos-1-a-4`](../adr/ADR-040-governanca-fluxo-issues-no-hub-e-planos-1-a-4.md)

## Matriz

| Código da falha | Sintoma observado | Arquivo/função corrigida | Teste(s) que validam | Critério de aceite | Status |
|---|---|---|---|---|---|
| **C-01** | Spike final podia violar bloqueio refratário absoluto quando mecanismos avançados eram encadeados. | `src/pyfolds/advanced/refractory.py` (`RefractoryMixin.forward`), `src/pyfolds/advanced/__init__.py` (ordem de mixins com refratário como autoridade final). | [`tests/unit/advanced/test_refractory.py::TestRefractoryMixin::test_refractory_blocks_spikes`](../../../tests/unit/advanced/test_refractory.py), [`tests/unit/advanced/test_refractory.py::TestRefractoryMixin::test_forward_increments_time_once`](../../../tests/unit/advanced/test_refractory.py) | Janela refratária absoluta deve forçar `spikes=0` e manter semântica temporal consistente por passo. | **Done** |
| **C-02** | Ganho de bAP era calculado, mas sem evidência funcional suficiente de acoplamento no caminho somático/dendrítico. | `src/pyfolds/advanced/backprop.py` (`BackpropMixin.forward`), `src/pyfolds/core/neuron.py` (`MPJRDNeuron.forward`, uso de `dendrite_amplification`). | [`tests/unit/advanced/test_backprop.py::TestBackpropMixin::test_bap_proportional_uses_dendritic_contribution`](../../../tests/unit/advanced/test_backprop.py), [`tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_batch_plasticity_preserves_local_pre_synaptic_rate`](../../../tests/unit/core/test_neuron.py) | bAP deve impactar caminho funcional (ganho em integração/plasticidade) e não apenas telemetria. | **Done** |
| **A-01** | Ambiguidade sobre fonte pré-sináptica do STDP (`x_raw` vs `x_stp`) gerava interpretação não explícita do aprendizado. | `src/pyfolds/advanced/stdp.py` (`STDPMixin.forward` e `_compute_pre_spike_signal`), `src/pyfolds/core/config.py` (`stdp_input_source`). | [`tests/unit/advanced/test_stdp.py::TestSTDPMixin::test_stdp_input_source_raw_vs_stp`](../../../tests/unit/advanced/test_stdp.py), [`tests/unit/core/test_config_advanced_order_flags.py::test_accepts_new_advanced_order_flags`](../../../tests/unit/core/test_config_advanced_order_flags.py) | Seleção da fonte STDP deve ser configurável e validada (`raw`/`stp`) com comportamento reprodutível. | **Done** |
| **A-02** | Incremento temporal podia divergir entre backprop/refratário, gerando offset de tempo entre mecanismos. | `src/pyfolds/advanced/time_mixin.py` (`TimedMixin.increment_time`), `src/pyfolds/advanced/backprop.py` (`BackpropMixin.forward`), `src/pyfolds/advanced/refractory.py` (`RefractoryMixin.forward`). | [`tests/unit/advanced/test_backprop.py::TestBackpropMixin::test_time_counter_advances_only_after_forward`](../../../tests/unit/advanced/test_backprop.py), [`tests/unit/advanced/test_refractory.py::TestRefractoryMixin::test_forward_increments_time_once`](../../../tests/unit/advanced/test_refractory.py) | `time_counter` deve avançar uma única vez por passo, sem offset entre mecanismos avançados. | **Done** |
| **A-03** | Termo pré-sináptico em BATCH podia perder localidade (normalização cruzada indevida), reduzindo especificidade hebbiana. | `src/pyfolds/core/neuron.py` (`MPJRDNeuron.apply_plasticity`, cálculo de `pre_rate` em BATCH). | [`tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_batch_plasticity_preserves_local_pre_synaptic_rate`](../../../tests/unit/core/test_neuron.py) | BATCH deve preservar média local por sinapse, sem normalização por número de sinapses ativas. | **Done** |

