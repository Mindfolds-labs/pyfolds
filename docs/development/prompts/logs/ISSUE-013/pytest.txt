============================= test session starts ==============================
platform linux -- Python 3.10.19, pytest-9.0.2, pluggy-1.6.0 -- /root/.pyenv/versions/3.10.19/bin/python
cachedir: .pytest_cache
rootdir: /workspace/pyfolds
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: cov-7.0.0
collecting ... collected 201 items / 3 deselected / 198 selected

tests/integration/test_advanced_integration.py::test_all_mixins_together_smoke PASSED [  0%]
tests/integration/test_neuron_advanced.py::TestAdvancedNeuron::test_full_pipeline PASSED [  1%]
tests/integration/test_training_loop.py::TestTrainingLoop::test_batch_training PASSED [  1%]
tests/performance/test_memory_usage.py::TestMemoryUsage::test_memory_leak PASSED [  2%]
tests/test_corruption_detection.py::test_bit_flip_is_detected PASSED     [  2%]
tests/test_corruption_detection.py::test_truncation_is_detected PASSED   [  3%]
tests/test_corruption_detection.py::test_invalid_magic_is_rejected PASSED [  3%]
tests/test_corruption_detection.py::test_huge_index_len_dos_guard PASSED [  4%]
tests/test_corruption_detection.py::test_partial_read_raises_eoferror PASSED [  4%]
tests/test_fold_corruption.py::test_fold_corruption_is_detected PASSED   [  5%]
tests/test_fold_fuzz.py::test_fold_reader_rejects_random_payload PASSED  [  5%]
tests/unit/advanced/test_adaptation.py::TestAdaptationMixin::test_initialization PASSED [  6%]
tests/unit/advanced/test_adaptation.py::TestAdaptationMixin::test_adaptation_decay PASSED [  6%]
tests/unit/advanced/test_adaptation.py::TestAdaptationMixin::test_adaptation_increment PASSED [  7%]
tests/unit/advanced/test_backprop.py::TestBackpropMixin::test_initialization PASSED [  7%]
tests/unit/advanced/test_backprop.py::TestBackpropMixin::test_backprop_queue PASSED [  8%]
tests/unit/advanced/test_backprop.py::TestBackpropMixin::test_dendrite_amplification_decay PASSED [  8%]
tests/unit/advanced/test_inhibition.py::TestInhibitionLayer::test_initialization PASSED [  9%]
tests/unit/advanced/test_inhibition.py::TestInhibitionLayer::test_lateral_kernel PASSED [  9%]
tests/unit/advanced/test_inhibition.py::TestInhibitionLayer::test_forward_feedforward PASSED [ 10%]
tests/unit/advanced/test_inhibition.py::TestInhibitionLayer::test_e2i_initialization_is_deterministic PASSED [ 10%]
tests/unit/advanced/test_inhibition.py::TestInhibitionMixin::test_forward_requires_initialized_inhibition PASSED [ 11%]
tests/unit/advanced/test_refractory.py::TestRefractoryMixin::test_initialization PASSED [ 11%]
tests/unit/advanced/test_refractory.py::TestRefractoryMixin::test_check_refractory_periods PASSED [ 12%]
tests/unit/advanced/test_refractory.py::TestRefractoryMixin::test_update_refractory PASSED [ 12%]
tests/unit/advanced/test_refractory.py::TestRefractoryMixin::test_refractory_blocks_spikes PASSED [ 13%]
tests/unit/advanced/test_short_term.py::TestShortTermDynamicsMixin::test_initialization PASSED [ 13%]
tests/unit/advanced/test_short_term.py::TestShortTermDynamicsMixin::test_update_no_spikes PASSED [ 14%]
tests/unit/advanced/test_short_term.py::TestShortTermDynamicsMixin::test_update_with_spikes PASSED [ 14%]
tests/unit/advanced/test_short_term.py::TestShortTermDynamicsMixin::test_tsodyks_markram_recovery PASSED [ 15%]
tests/unit/advanced/test_stdp.py::TestSTDPMixin::test_initialization PASSED [ 15%]
tests/unit/advanced/test_stdp.py::TestSTDPMixin::test_trace_decay PASSED [ 16%]
tests/unit/advanced/test_stdp.py::TestSTDPMixin::test_pre_spike_updates_trace PASSED [ 16%]
tests/unit/advanced/test_stdp.py::TestSTDPMixin::test_should_apply_stdp PASSED [ 17%]
tests/unit/advanced/test_stdp.py::TestSTDPMixin::test_stdp_does_not_update_global_I_online PASSED [ 17%]
tests/unit/core/test_accumulator.py::TestStatisticsAccumulator::test_initialization PASSED [ 18%]
tests/unit/core/test_accumulator.py::TestStatisticsAccumulator::test_accumulate PASSED [ 18%]
tests/unit/core/test_accumulator.py::TestStatisticsAccumulator::test_history_respects_max_len PASSED [ 19%]
tests/unit/core/test_accumulator.py::TestStatisticsAccumulator::test_accumulate_rejects_invalid_shape PASSED [ 19%]
tests/unit/core/test_accumulator.py::TestStatisticsAccumulator::test_track_extra_accumulates_scalars_and_vectors PASSED [ 20%]
tests/unit/core/test_accumulator.py::TestStatisticsAccumulator::test_reset_clears_state_and_history PASSED [ 20%]
tests/unit/core/test_config.py::TestMPJRDConfig::test_default_values PASSED [ 21%]
tests/unit/core/test_config.py::TestMPJRDConfig::test_custom_values PASSED [ 21%]
tests/unit/core/test_config.py::TestMPJRDConfig::test_validation PASSED  [ 22%]
tests/unit/core/test_config.py::TestMPJRDConfig::test_get_decay_rate_validation PASSED [ 22%]
tests/unit/core/test_config.py::TestMPJRDConfig::test_get_decay_rate_negative_dt_validation PASSED [ 23%]
tests/unit/core/test_config.py::TestMPJRDConfig::test_numerical_safety_validation PASSED [ 23%]
tests/unit/core/test_dendrite.py::TestMPJRDDendrite::test_initialization PASSED [ 24%]
tests/unit/core/test_dendrite.py::TestMPJRDDendrite::test_forward PASSED [ 24%]
tests/unit/core/test_dendrite.py::TestMPJRDDendrite::test_u_R_optional_state PASSED [ 25%]
tests/unit/core/test_dendrite.py::TestMPJRDDendrite::test_update_uses_local_pre_rate_per_synapse PASSED [ 25%]
tests/unit/core/test_factory.py::test_create_neuron_infers_standard_type PASSED [ 26%]
tests/unit/core/test_factory.py::test_create_neuron_infers_wave_type PASSED [ 26%]
tests/unit/core/test_factory.py::test_factory_raises_for_unregistered_type PASSED [ 27%]
tests/unit/core/test_health_monitor.py::test_health_monitor_runs_and_scores PASSED [ 27%]
tests/unit/core/test_homeostasis.py::TestHomeostasisController::test_initialization PASSED [ 28%]
tests/unit/core/test_homeostasis.py::TestHomeostasisController::test_update PASSED [ 28%]
tests/unit/core/test_homeostasis.py::TestHomeostasisController::test_is_stable_accepts_tolerance PASSED [ 29%]
tests/unit/core/test_homeostasis.py::TestHomeostasisController::test_update_limits_theta_step PASSED [ 29%]
tests/unit/core/test_monitoring_and_checkpoint.py::test_health_check_critical_for_dead_neurons PASSED [ 30%]
tests/unit/core/test_monitoring_and_checkpoint.py::test_versioned_checkpoint_save_and_load PASSED [ 30%]
tests/unit/core/test_neuromodulation.py::TestNeuromodulator::test_external_mode PASSED [ 31%]
tests/unit/core/test_neuromodulation.py::TestNeuromodulator::test_surprise_mode PASSED [ 31%]
tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_initialization PASSED [ 32%]
tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_forward PASSED     [ 32%]
tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_step_alias PASSED  [ 33%]
tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_online_plasticity_updates_when_not_deferred PASSED [ 33%]
tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_modes[online] PASSED [ 34%]
tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_modes[batch] PASSED [ 34%]
tests/unit/core/test_neuron.py::TestMPJRDNeuron::test_modes[inference] PASSED [ 35%]
tests/unit/core/test_neuron_v2.py::test_forward_shapes_v2 PASSED         [ 35%]
tests/unit/core/test_neuron_v2.py::test_cooperative_sum_uses_multiple_dendrites PASSED [ 36%]
tests/unit/core/test_synapse.py::TestMPJRDSynapse::test_initialization PASSED [ 36%]
tests/unit/core/test_synapse.py::TestMPJRDSynapse::test_ltp PASSED       [ 37%]
tests/unit/core/test_synapse.py::TestMPJRDSynapse::test_update_respects_plastic_flag PASSED [ 37%]
tests/unit/core/test_synapse.py::TestMPJRDSynapse::test_update_filters_inactive_pre_synaptic_activity PASSED [ 38%]
tests/unit/core/test_synapse.py::TestMPJRDSynapse::test_update_uses_absolute_dt_and_mode_multiplier PASSED [ 38%]
tests/unit/core/test_synapse.py::TestMPJRDSynapse::test_saturation_recovery_disables_protection_after_timeout PASSED [ 39%]
tests/unit/core/test_synapse.py::TestMPJRDSynapse::test_consolidate_transfers_eligibility_and_decays_internal_potential PASSED [ 39%]
tests/unit/network/test_network_edge_cases.py::test_prepare_input_with_single_dendrite_avoids_division_by_zero PASSED [ 40%]
tests/unit/serialization/test_foldio.py::test_fold_roundtrip_and_peek PASSED [ 40%]
tests/unit/serialization/test_foldio.py::test_training_then_save_with_telemetry_and_history_and_nuclear_arrays PASSED [ 41%]
tests/unit/serialization/test_foldio.py::test_detects_corruption PASSED  [ 41%]
tests/unit/serialization/test_foldio.py::test_hierarchical_hashes_present_in_metadata PASSED [ 42%]
tests/unit/serialization/test_foldio.py::test_ecc_from_protection_mapping PASSED [ 42%]
tests/unit/serialization/test_foldio.py::test_ecc_roundtrip_if_available PASSED [ 43%]
tests/unit/serialization/test_foldio.py::test_crc32c_matches_known_vector PASSED [ 43%]
tests/unit/serialization/test_foldio.py::test_fold_reader_bounds_validation_with_mmap PASSED [ 44%]
tests/unit/serialization/test_foldio.py::test_fold_reader_bounds_validation_negative_values PASSED [ 44%]
tests/unit/serialization/test_foldio.py::test_fold_reader_index_size_validation PASSED [ 45%]
tests/unit/serialization/test_foldio.py::test_fold_reader_index_offset_validation PASSED [ 45%]
tests/unit/serialization/test_foldio.py::test_fold_reader_header_len_validation PASSED [ 46%]
tests/unit/serialization/test_foldio.py::test_fold_writer_finalize_wraps_io_failure_with_phase_context PASSED [ 46%]
tests/unit/serialization/test_foldio.py::test_fold_reader_reports_magic_values PASSED [ 47%]
tests/unit/serialization/test_foldio.py::test_fold_reader_exit_closes_file_even_if_mmap_close_fails PASSED [ 47%]
tests/unit/serialization/test_foldio.py::test_fold_writer_finalize_wraps_failures_with_phase[write_index-<lambda>-flush failed] PASSED [ 48%]
tests/unit/serialization/test_foldio.py::test_fold_writer_finalize_wraps_failures_with_phase[fsync_index-<lambda>-fsync index failed] PASSED [ 48%]
tests/unit/serialization/test_foldio.py::test_fold_writer_finalize_wraps_failures_with_phase[write_header-<lambda>-seek failed] PASSED [ 49%]
tests/unit/serialization/test_foldio.py::test_fold_writer_finalize_wraps_failures_with_phase[write_header-<lambda>-write failed] PASSED [ 50%]
tests/unit/telemetry/test_controller.py::TestTelemetryController::test_initialization PASSED [ 50%]
tests/unit/telemetry/test_controller.py::TestTelemetryController::test_profile_off PASSED [ 51%]
tests/unit/telemetry/test_controller.py::TestTelemetryController::test_profile_light PASSED [ 51%]
tests/unit/telemetry/test_controller.py::TestTelemetryController::test_profile_heavy PASSED [ 52%]
tests/unit/telemetry/test_controller.py::TestTelemetryController::test_should_emit_sample PASSED [ 52%]
tests/unit/telemetry/test_controller.py::TestTelemetryController::test_step_count_increments PASSED [ 53%]
tests/unit/telemetry/test_controller.py::TestTelemetryController::test_snapshot_and_clear PASSED [ 53%]
tests/unit/telemetry/test_controller.py::TestTelemetryController::test_get_stats PASSED [ 54%]
tests/unit/telemetry/test_decorator.py::TestTelemetryDecorator::test_decorator_basic PASSED [ 54%]
tests/unit/telemetry/test_decorator.py::TestTelemetryDecorator::test_decorator_with_sample_rate PASSED [ 55%]
tests/unit/telemetry/test_decorator.py::TestTelemetryDecorator::test_decorator_lazy_evaluation PASSED [ 55%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_append PASSED [ 56%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_snapshot_with_none PASSED [ 56%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_empty_snapshot PASSED [ 57%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_len PASSED [ 57%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_clear PASSED [ 58%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_capacity_property PASSED [ 58%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_is_full PASSED [ 59%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_extend PASSED [ 59%]
tests/unit/telemetry/test_ringbuffer.py::TestRingBuffer::test_thread_safety PASSED [ 60%]
tests/unit/telemetry/test_sinks.py::TestMemorySink::test_emit PASSED     [ 60%]
tests/unit/telemetry/test_sinks.py::TestMemorySink::test_capacity_limit PASSED [ 61%]
tests/unit/telemetry/test_sinks.py::TestMemorySink::test_clear PASSED    [ 61%]
tests/unit/telemetry/test_sinks.py::TestConsoleSink::test_verbose PASSED [ 62%]
tests/unit/telemetry/test_sinks.py::TestConsoleSink::test_non_verbose PASSED [ 62%]
tests/unit/telemetry/test_sinks.py::TestJSONLinesSink::test_emit_basic PASSED [ 63%]
tests/unit/telemetry/test_sinks.py::TestJSONLinesSink::test_truncate_mode PASSED [ 63%]
tests/unit/telemetry/test_sinks.py::TestJSONLinesSink::test_append_mode PASSED [ 64%]
tests/unit/telemetry/test_sinks.py::TestJSONLinesSink::test_tensor_serialization PASSED [ 64%]
tests/unit/telemetry/test_sinks.py::TestJSONLinesSink::test_depth_limit_serialization PASSED [ 65%]
tests/unit/telemetry/test_sinks.py::TestJSONLinesSink::test_non_serializable_fallback PASSED [ 65%]
tests/unit/telemetry/test_sinks.py::TestDistributorSink::test_distributes_to_all_sinks PASSED [ 66%]
tests/unit/telemetry/test_sinks.py::TestDistributorSink::test_sink_failure_doesnt_affect_others PASSED [ 66%]
tests/unit/telemetry/test_types.py::TestPayloadTypes::test_forward_payload PASSED [ 67%]
tests/unit/telemetry/test_types.py::TestPayloadTypes::test_commit_payload PASSED [ 67%]
tests/unit/telemetry/test_types.py::TestPayloadTypes::test_sleep_payload PASSED [ 68%]
tests/unit/test_design_improvements.py::test_factory_creates_builtin_types PASSED [ 68%]
tests/unit/test_design_improvements.py::test_factory_custom_registry_and_unknown_type PASSED [ 69%]
tests/unit/test_design_improvements.py::test_learning_mode_context_restores_even_on_error PASSED [ 69%]
tests/unit/test_design_improvements.py::test_network_builder_connects_layers_and_builds PASSED [ 70%]
tests/unit/test_layer_neuron_class.py::test_layer_accepts_neuron_v2 PASSED [ 70%]
tests/unit/test_layer_neuron_class.py::test_layer_rejects_invalid_neuron_cls PASSED [ 71%]
tests/unit/test_layer_neuron_class.py::test_layer_has_no_legacy_neuron_class_attr PASSED [ 71%]
tests/unit/utils/test_device.py::TestDevice::test_infer_device PASSED    [ 72%]
tests/unit/utils/test_device.py::TestDevice::test_get_device PASSED      [ 72%]
tests/unit/utils/test_math.py::TestMath::test_safe_div PASSED            [ 73%]
tests/unit/utils/test_math.py::TestMath::test_clamp_rate PASSED          [ 73%]
tests/unit/utils/test_math.py::TestMath::test_clamp_R PASSED             [ 74%]
tests/unit/utils/test_math.py::TestMath::test_safe_weight_law_is_bounded_and_finite PASSED [ 74%]
tests/unit/utils/test_types.py::TestTypes::test_learning_mode PASSED     [ 75%]
tests/unit/utils/test_types.py::TestTypes::test_connection_type PASSED   [ 75%]
tests/unit/utils/test_utils.py::TestMath::test_safe_div_basic PASSED     [ 76%]
tests/unit/utils/test_utils.py::TestMath::test_safe_div_by_zero PASSED   [ 76%]
tests/unit/utils/test_utils.py::TestMath::test_clamp_rate_tensor PASSED  [ 77%]
tests/unit/utils/test_utils.py::TestMath::test_clamp_rate_float PASSED   [ 77%]
tests/unit/utils/test_utils.py::TestMath::test_clamp_R_tensor PASSED     [ 78%]
tests/unit/utils/test_utils.py::TestMath::test_clamp_R_float PASSED      [ 78%]
tests/unit/utils/test_utils.py::TestMath::test_xavier_init_shape PASSED  [ 79%]
tests/unit/utils/test_utils.py::TestMath::test_xavier_init_gain PASSED   [ 79%]
tests/unit/utils/test_utils.py::TestMath::test_calculate_vc_dimension PASSED [ 80%]
tests/unit/utils/test_utils.py::TestDevice::test_infer_device_none PASSED [ 80%]
tests/unit/utils/test_utils.py::TestDevice::test_infer_device_tensor_cpu PASSED [ 81%]
tests/unit/utils/test_utils.py::TestDevice::test_infer_device_tensor_cuda PASSED [ 81%]
tests/unit/utils/test_utils.py::TestDevice::test_infer_device_dict PASSED [ 82%]
tests/unit/utils/test_utils.py::TestDevice::test_infer_device_empty_dict PASSED [ 82%]
tests/unit/utils/test_utils.py::TestDevice::test_ensure_device_no_change PASSED [ 83%]
tests/unit/utils/test_utils.py::TestDevice::test_ensure_device_move PASSED [ 83%]
tests/unit/utils/test_utils.py::TestDevice::test_get_device_default PASSED [ 84%]
tests/unit/utils/test_utils.py::TestDevice::test_get_device_specific PASSED [ 84%]
tests/unit/utils/test_utils.py::TestTypes::test_learning_mode_values PASSED [ 85%]
tests/unit/utils/test_utils.py::TestTypes::test_learning_mode_description PASSED [ 85%]
tests/unit/utils/test_utils.py::TestTypes::test_learning_rate_multiplier PASSED [ 86%]
tests/unit/utils/test_utils.py::TestTypes::test_is_learning PASSED       [ 86%]
tests/unit/utils/test_utils.py::TestTypes::test_is_consolidating PASSED  [ 87%]
tests/unit/utils/test_utils.py::TestTypes::test_connection_type PASSED   [ 87%]
tests/unit/utils/test_utils.py::TestTypes::test_mode_config_defaults PASSED [ 88%]
tests/unit/utils/test_utils.py::TestTypes::test_mode_config_get_learning_rate PASSED [ 88%]
tests/unit/utils/test_utils.py::TestTypes::test_mode_config_get_consolidation_factor PASSED [ 89%]
tests/unit/utils/test_utils.py::TestLogging::test_trace_level_defined PASSED [ 89%]
tests/unit/utils/test_utils.py::TestLogging::test_trace_method_exists PASSED [ 90%]
tests/unit/utils/test_utils.py::TestLogging::test_get_logger PASSED      [ 90%]
tests/unit/utils/test_utils.py::TestLogging::test_pyfolds_logger_singleton PASSED [ 91%]
tests/unit/utils/test_utils.py::TestLogging::test_logger_setup_basic PASSED [ 91%]
tests/unit/utils/test_utils.py::TestLogging::test_logger_trace_output PASSED [ 92%]
tests/unit/utils/test_utils.py::TestLogging::test_logger_trace_silent_when_lower_level PASSED [ 92%]
tests/unit/utils/test_utils.py::TestLogging::test_logger_file_handler PASSED [ 93%]
tests/unit/utils/test_utils.py::TestLogging::test_multiple_loggers_same_name PASSED [ 93%]
tests/unit/utils/test_utils.py::TestLogging::test_module_levels PASSED   [ 94%]
tests/unit/utils/test_utils.py::TestIntegration::test_logging_with_device PASSED [ 94%]
tests/unit/utils/test_utils.py::TestIntegration::test_learning_mode_with_math PASSED [ 95%]
tests/unit/utils/test_utils.py::TestIntegration::test_device_with_tensor_ops PASSED [ 95%]
tests/unit/utils/test_validation.py::test_neuron_forward_validation_ndim PASSED [ 96%]
tests/unit/utils/test_validation.py::test_neuron_forward_validation_dtype PASSED [ 96%]
tests/unit/wave/test_wave_config.py::test_wave_config_defaults_valid PASSED [ 97%]
tests/unit/wave/test_wave_config.py::test_wave_config_rejects_invalid_buffer PASSED [ 97%]
tests/unit/wave/test_wave_layer_network.py::test_wave_layer_exposes_wave_outputs PASSED [ 98%]
tests/unit/wave/test_wave_layer_network.py::test_wave_network_forwards_layer_kwargs PASSED [ 98%]
tests/unit/wave/test_wave_neuron.py::test_wave_outputs_quadrature_and_phase_range PASSED [ 99%]
tests/unit/wave/test_wave_neuron.py::test_cooperative_integration_uses_multiple_dendrites PASSED [100%]

=============================== warnings summary ===============================
tests/performance/test_batch_speed.py:9
  /workspace/pyfolds/tests/performance/test_batch_speed.py:9: PytestUnknownMarkWarning: Unknown pytest.mark.performance - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.performance

tests/unit/serialization/test_foldio.py::test_fold_reader_exit_closes_file_even_if_mmap_close_fails
  /workspace/pyfolds/tests/unit/serialization/test_foldio.py:306: RuntimeWarning: Erro ao fechar mmap de '/tmp/pytest-of-root/pytest-0/test_fold_reader_exit_closes_f0/cleanup.fold': forced close error
    reader.__exit__(None, None, None)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================ 198 passed, 3 deselected, 2 warnings in 1.62s =================
